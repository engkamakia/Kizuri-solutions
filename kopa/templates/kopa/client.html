{% extends 'kopa/layout.html' %} {% load static %} {% block content %}

<main>
  <!-- Hero Start-->
  <!-- ... -->
  <style>
    /* Custom CSS for form fields */
    .form-row .form-group.col-md-12 select {
      width: 100%;
    }

    /* Ensuring all conditional fields are hidden by default */
    .conditional-section {
      display: none;
    }

    .border-box {
    border: 2px solid #000; /* Black border, you can change the color and thickness as needed */
    padding: 10px; /* Space between the border and the text */
    margin: 10px 0; /* Space around the border box */
    border-radius: 5px; /* Rounded corners, remove if you prefer square corners */
    background-color: #f9f9f9; /* Light background color, change as needed */
  }

   .input-group {
            margin-bottom: 15px;
        }
        #residence_description {
            display: none;
        }

        .alert.error {
    background-color: #e74c3c;
    color: white; /* Ensure the text is readable */
    padding: 10px;
    border-radius: 5px;
}

.alert.success {
    background-color: #2ecc71;
    color: white; /* Ensure the text is readable */
    padding: 10px;
    border-radius: 5px;
}

        
  </style>

  <!-- Apply Area Start -->
  <div class="hero-area2 slider-height2 hero-overly2 d-flex align-items-center">
    <div class="container">
      <div class="row">
        <div class="col-xl-12">
           <!-- Display messages -->
        {% if messages %}
    <div>
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} custom-alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
          <div class="hero-cap text-center pt-50">
            <h2>Client Commitment Form</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="apply-area pt-150 pb-150">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="apply-wrapper">
            <!-- Form -->
            <form method="post" action="{% url 'client' %}" enctype="multipart/form-data" class="needs-validation" novalidate>
              {% csrf_token %}
              {% if not existing_profile %}

              

              

              <!-- Progress bar -->
              <div class="progressbar">
                <div class="progress" id="progress"></div>

                <div
                  class="progress-step progress-step-active"
                  data-title="Client info"
                ></div>
                <div class="progress-step" data-title="Family info"></div>
                <div class="progress-step" data-title="Residence info"></div>
                <div class="progress-step" data-title="Collateral info"></div>
              </div>

              <!-- Steps -->
              <div class="form-step form-step-active">
                <h5 class="text-center"><b>CLIENT INFO<b></h5>
                <!--<div class="input-group">
                  <label for="Fullname">Full name</label>
                  <input type="text" name="Fullname" id="Fullname" />
                </div>-->
                <div class="input-group">
                  <label for="Nickname">Nick name *(Required)</label>
                  <input type="text" name="Nickname" id="Nickname" required/>
                </div>
                <!--<div class="input-group">
                  <label for="NationalId">ID number</label>
                  <input
                    type="number"
                    name="NationalId"
                    NationalId="NationalId"
                  />
                </div>-->
                <div class="input-group">
                  <label for="phone1">Phone 1 *(Required)</label>
                  <input type="text" name="phone1" id="phone1" required/>
                </div>
                <div class="input-group">
                  <label for="phone2">Phone 2 <i>(optional)</i></label>
                  <input type="text" name="phone2" id="phone2" />
                </div>
                <div class="input-group">
  <label for="image">Upload photo of your face *(Required)</label>
  <input type="file" name="face_image" id="face_image" accept="image/*" required/>
</div>
                <!--<div class="input-group">
                  <label for="email">Email</label>
                  <input type="text" name="email" id="email" />
                </div>-->

                <div class="">
                  <label for="employment-status"
                    >Employment Status:
                    <i>(Kindly select from buttons below)</i></label
                  >
                  <select
                    id="employment-status"
                    name="employment-status"
                    onchange="showFields()"
                  >
                    <option value="">Select...</option>
                    <option value="employed">Employed</option>
                    <option value="unemployed">Unemployed</option>
                    <option value="self-employed">Self-employed</option>
                  </select>

                  <div id="employed-fields" class="conditional-section">
                    <br /><br />
                    <label for="employer-name">Employers Name:*</label>
                    <input
                      type="text"
                      id="employer-name"
                      name="employer-name"
                    required/>

                    <label for="job-title">Job Title:</label>
                    <input type="text" id="job-title" name="job-title" />
                    <label for="location_of_work">Location of work: *(Required)</label>
                    <input
                      type="text"
                      id="location_of_work"
                      name="location_of_work"
                    required/>
                    <label for="supervisors_name">Supervisors name: *(Required)</label>
                    <input
                      type="text"
                      id="supervisors_name"
                      name="supervisors_name"
                    required/>
                    <label for="supervisors_contact"
                      >Supervisors contact: *(Required)</label
                    >
                    <input
                      type="text"
                      id="supervisors_contact"
                      name="supervisors_contact"
                    required/>
                    <label for="monthly_income">Net monthly income: *(Required)</label>
                    <input
                      type="text"
                      id="monthly_income"
                      name="monthly_income"
                    required/>
                    <label for="monthly_expense">Monthly expense: *(Required)</label>
                    <input
                      type="text"
                      id="monthly_expense"
                      name="monthly_expense"
                    required/>
                  </div>

                  <div id="unemployed-fields" class="conditional-section">
                    <br /><br />
                    <label for="unemployment-reason"
                      >Reason for Unemployment: (optional)</label
                    >
                    <input
                      type="text"
                      id="unemployment-reason"
                      name="unemployment-reason"
                    />
                  </div>

                  <div id="self-employed-fields" class="conditional-section">
                    <br /><br />
                    <label for="business-name">Business Name: *(Required)</label>
                    <input
                      type="text"
                      id="business-name"
                      name="business-name"
                    required/>

                    <label for="industry-type">Industry Type: *(Required)</label>
                    <input
                      type="text"
                      id="industry-type"
                      name="industry-type"
                    required/>
                    <label for="business_location">Business location: *(Required)</label>
                    <input
                      type="text"
                      id="business_location"
                      name="business_location"
                    required/>
                    <label for="daily_income">Daily income: *(Required)</label>
                    <input type="text" id="daily_income" name="daily_income"required />
                    <label for="daily_expense">Daily expense: *(Required)</label>
                    <input
                      type="text"
                      id="daily_expense"
                      name="daily_expense"
                    required/>
                    <label for="net_income">Net income: *(Required)</label>
                    <input type="text" id="net_income" name="net_income" required/>
                  </div>
                </div>

                <div class="input-group">
                  <label for="loan_amount">Loan amount *(Required)</label>
                  <input type="text" name="loan_amount" id="loan_amount" required/>
                </div>
                <div class="input-group">
                  <label for="amount_in_words">Loan amount in words *(Required)</label>
                  <input
                    type="text"
                    name="amount_in_words"
                    id="amount_in_words"
                  required/>
                </div>
                <div class="input-group">
                  <label for="date_of_loan">Date loan taken *(Required)</label>
                  <input type="date" name="date_of_loan" id="date_of_loan" required/>
                </div>
                <div class="input-group">
                  <label for="repay_principal">Repay principal *(Required)</label>
                  <input
                    type="text"
                    name="repay_principal"
                    id="repay_principal"
                  required/>
                </div>
                <div class="input-group">
                  <label for="interest">Interest *(Required)</label>
                  <input type="text" name="interest" id="interest" />
                </div>
                <div class="input-group">
                  <label for="total">Total *(Required)</label>
                  <input type="text" name="total" id="total" />
                </div>
                <div class="input-group">
                  <label for="repay_date">Repay on or before *(Required)</label>
                  <input type="date" name="repay_date" id="repay_date" />
                </div>

                <br /><br /><br />
                <div class="">
                  <a href="#" class="btn btn-next width-50 ml-auto">Next</a>
                </div>
              </div>
              <div class="form-step">
                <h5 class="text-center"><b>FAMILY INFORMATION<b></h5>
                <div class="">
                  <label for="marital-status"
                    >Marital Status:
                    <i>(Kindly select from button below)</i> *(Required)</label
                  >
                  <select
                    id="marital-status"
                    name="marital-status"
                    onchange="showMaritalFields()"
                  >
                    <option value="">Select...</option>
                    <option value="married">Married</option>
                    <option value="single">Single</option>
                  </select>

                  <div id="married-fields" class="conditional-section">
                    <br /><br />
                    <label for="spouse-name">Spouse's Name:</label>
                    <input type="text" id="spouse-name" name="spouse-name" />

                    <label for="work_place">Work place:</label>
                    <input type="text" id="work_place" name="work_place" />
                    <label for="position">Position:</label>
                    <input type="text" id="position" name="position" />
                    <label for="contact">Contact:</label>
                    <input type="text" id="contact" name="contact" />
                    <label for="no_of_dependants">Number of dependants:</label>
                    <input
                      type="text"
                      id="no_of_dependants"
                      name="no_of_dependants"
                    />
                  </div>

                  <div id="single-fields" class="conditional-section">
                    <br /><br />
                    <label for="no_of_dependants">Number of dependants:</label>
                    <input
                      type="text"
                      id="no_of_dependants"
                      name="no_of_dependants"
                    />
                  </div>
                  <br><br>

                  
  <div class="">
    <label for="parent-type">Parent Details: 
      <i>(Kindly select from the options below) *(Required)</i>
    </label>
    <select id="parent-type" name="parent-type" onchange="showParentFields()">
      <option value="">Select...</option>
      <option value="father">Father Details</option>
      <option value="mother">Mother Details</option>
    </select>

    <div id="father-fields" class="conditional-section" style="display:none;">
      <br /><br />
      <label for="father-full-name">Father's Full Name:</label>
      <input type="text" id="father-full-name" name="father-full-name" />
      
      <label for="father-contact">Father's Contact:</label>
      <input type="text" id="father-contact" name="father-contact" />
    </div>

    <div id="mother-fields" class="conditional-section" style="display:none;">
      <br /><br />
      <label for="mother-full-name">Mother's Full Name:</label>
      <input type="text" id="mother-full-name" name="mother-full-name" />
      
      <label for="mother-contact">Mother's Contact:</label>
      <input type="text" id="mother-contact" name="mother-contact" />
    </div>
  </div>

  <div class="input-group">
                  <label for="nextofkin">Next of Kin *(Required)</label>
                  <input type="text" name="nextofkin" id="nextofkin" />
                </div>

                </div>
                
                <br /><br /><br />
                <div>
                  <div class="btns-group">
                    <a href="#" class="btn btn-prev">Previous</a>
                    <a href="#" class="btn btn-next">Next</a>
                  </div>
                </div>
              </div>
              <div class="form-step">
                <h5 class="text-center"><b>RESIDENCE INFORMATION</b></h5>
    <div class="input-group">
        <label for="residence_type">Select your residence type:</label>
        <select id="residence_type" name="residence_type" onchange="showDescriptionField()">
            <option value="">--Select--</option>
            <option value="permanent">Permanent Residence</option>
            <option value="temporary">Temporary Residence</option>
        </select>
    </div>
    <div id="residence_description" class="input-group">
        <label for="residence_description_input">Short description of location:</label>
        <textarea
        id="residence_description_input"
        name="residence_description"
        
        maxlength="255"
        rows="4"   
        cols="50"   
        required    
    ></textarea>
    </div>
    <div class="input-group">
                  <label for="rural_residence"
                    >Applicants rural residence:<i> *(Required)</i></label
                  >
                  <input
                    type="text"
                    id="rural_residence"
                    name="rural_residence"
                    placeholder="eg. Ngoingwa, Thika"
                  />
                </div> 
    <script>
        function showDescriptionField() {
            var residenceType = document.getElementById('residence_type').value;
            var descriptionField = document.getElementById('residence_description');

            if (residenceType) {
                descriptionField.style.display = 'block';
            } else {
                descriptionField.style.display = 'none';
            }
        }
    </script>

                <div class="btns-group">
                  <a href="#" class="btn btn-prev">Previous</a>
                  <a href="#" class="btn btn-next">Next</a>
                </div>
              </div>
              <div class="form-step">
                 <h5 class="text-center"><b>COLLATERAL INFORMATION</b></h5>

              <label> *(Required)</label>
              <input type="hidden" id="item_count" name="item_count" value="0">
    <div id="collateral-items"></div>
    <button type="button" onclick="addCollateralItem()"><b>Add Collateral Items</b></button>
    
    <div class="input-group">
  <label for="image">Upload photo of your signature *(Required)</label>
  <input type="file" name="signature_image" id="signature_image" accept="image/*" />
</div>


    

    <br><br>
                
                <!--<h5 class="text-center"><b>CRB INFORMATION<b></h5>-->
                <p class="border-box">
                  <b>I <i>{{request.user.first_name}} </i>of ID number <i>{{request.user.id_number}} </i> Authorize Kizuri Solutions Limited to access my credit profile from credit reference bureau.</b>
                  
                </p>

                 <div class="input-group">
        <label for="agree_to_terms">
          I agree to the Terms and Conditions *(Required)
            <input type="checkbox" id="agree_to_terms" name="agree_to_terms" required>
            
        </label>
    </div>
               
                <div class="btns-group">
                  <a href="#" class="btn btn-prev">Previous</a>
                  <br /><br />
                  
    
                  <input type="submit" value="Submit" class="btn" id="submit_button"/>
                </div>
              </div>



              {% else %}


              <!-- Progress bar -->
              <div class="progressbar">
                <div class="progress" id="progress"></div>

                <div
                  class="progress-step progress-step-active"
                  data-title="Loan info"
                ></div>
                <div class="progress-step" data-title="Family info"></div>
                <div class="progress-step" data-title="Residence info"></div>
                <div class="progress-step" data-title="Collateral info"></div>
              </div>

              <!-- Steps -->
              <div class="form-step form-step-active">
                <h5 class="text-center"><b>LOAN INFO <b></h5>
                
                <div class="input-group">
                  <label for="loan_amount">Loan amount<i>*(Required)</i></label>
                  <input type="text" name="loan_amount" id="loan_amount" required/>
                </div>
                <div class="input-group">
                  <label for="amount_in_words">Loan amount in words<i>*(Required)</i></label>
                  <input
                    type="text"
                    name="amount_in_words"
                    id="amount_in_words"
                  required/>
                </div>
                <div class="input-group">
                  <label for="date_of_loan">Date loan taken<i>*(Required)</i></label>
                  <input type="date" name="date_of_loan" id="date_of_loan" required/>
                </div>
                <div class="input-group">
                  <label for="repay_principal">Repay principal<i>*(Required)</i></label>
                  <input
                    type="text"
                    name="repay_principal"
                    id="repay_principal"
                  required/>
                </div>
                <div class="input-group">
                  <label for="interest">Interest<i>*(Required)</i></label>
                  <input type="text" name="interest" id="interest" required/>
                </div>
                <div class="input-group">
                  <label for="total">Total<i>*(Required)</i></label>
                  <input type="text" name="total" id="total" required/>
                </div>
                <div class="input-group">
                  <label for="repay_date">Repay on or before<i>*(Required)</i></label>
                  <input type="date" name="repay_date" id="repay_date" required/>
                </div>

                <br /><br /><br />
                <div class="">
                  <a href="#" class="btn btn-next width-50 ml-auto">Next</a>
                </div>
              </div>
              <div class="form-step">
                
                <p class="center" >Already filled</p>
                
                <br /><br /><br />
                <div>
                  <div class="btns-group">
                    <a href="#" class="btn btn-prev">Previous</a>
                    <a href="#" class="btn btn-next">Next</a>
                  </div>
                </div>
              </div>
              <div class="form-step">
                <h5 class="text-center"><b>RESIDENCE INFORMATION</b></h5>
    
                <p class="center" >Already filled</p>
    <script>
        function showDescriptionField() {
            var residenceType = document.getElementById('residence_type').value;
            var descriptionField = document.getElementById('residence_description');

            if (residenceType) {
                descriptionField.style.display = 'block';
            } else {
                descriptionField.style.display = 'none';
            }
        }
    </script>

                <div class="btns-group">
                  <a href="#" class="btn btn-prev">Previous</a>
                  <a href="#" class="btn btn-next">Next</a>
                </div>
              </div>
              <div class="form-step">
                 <h5 class="text-center"><b>COLLATERAL INFORMATION</b></h5>

              <label>Upload upto three collateral items *(Required)</label>
              <input type="hidden" id="item_count" name="item_count" value="0">
    <div id="collateral-items"></div>
    <button type="button" onclick="addCollateralItem()"><b>Add Collateral Item</b></button>
    
    <div class="input-group">
  <label for="image">Upload photo of your signature<i> *(Required)</i></label>
  <input type="file" name="image" id="image" accept="image/*" required/>
</div>


    

    <br><br>
                
                <!--<h5 class="text-center"><b>CRB INFORMATION<b></h5>-->
                <p class="border-box">
                  <b>I <i>{{request.user.first_name}} </i>of ID number <i>{{request.user.id_number}} </i> Authorize Kizuri Solutions Limited to access my credit profile from credit reference bureau.</b>
                  
                </p>

                 <div class="input-group">
        <label for="agree_to_terms">
           I agree to the Terms and Conditions *(Required)
            <input type="checkbox" id="agree_to_terms" name="agree_to_terms" required>
           
        </label>
    </div>
               
                <div class="btns-group">
                  <a href="#" class="btn btn-prev">Previous</a>
                  <br /><br />
                  
    
                  <input type="submit" value="Submit" class="btn" id="submit_button" />
                </div>
              </div>

              {% endif %}

              {% csrf_token %}
            </form>
  <script>
        document.addEventListener('DOMContentLoaded', function () {
            const checkbox = document.getElementById('agree_to_terms');
            const submitButton = document.getElementById('submit_button');

            // Function to toggle button visibility
            function toggleSubmitButton() {
                if (checkbox.checked) {
                    submitButton.style.display = 'inline'; // Show the button
                } else {
                    submitButton.style.display = 'none'; // Hide the button
                }
            }

            // Check the initial state
            toggleSubmitButton();

            // Add event listener for checkbox changes
            checkbox.addEventListener('change', toggleSubmitButton);
        });
    </script>
            
<script>
              function showFields() {
                const status =
                  document.getElementById("employment-status").value;

                // Hide all sections first
                document.getElementById("employed-fields").style.display =
                  "none";
                document.getElementById("unemployed-fields").style.display =
                  "none";
                document.getElementById("self-employed-fields").style.display =
                  "none";

                // Show the relevant section based on selection
                if (status === "employed") {
                  document.getElementById("employed-fields").style.display =
                    "block";
                } else if (status === "unemployed") {
                  document.getElementById("unemployed-fields").style.display =
                    "block";
                } else if (status === "self-employed") {
                  document.getElementById(
                    "self-employed-fields"
                  ).style.display = "block";
                }
              }

              function showMaritalFields() {
                const status = document.getElementById("marital-status").value;

                // Hide all marital-related sections
                document.getElementById("married-fields").style.display =
                  "none";
                document.getElementById("single-fields").style.display = "none";

                // Show the relevant section based on marital status
                if (status === "married") {
                  document.getElementById("married-fields").style.display =
                    "block";
                } else if (status === "single") {
                  document.getElementById("single-fields").style.display =
                    "block";
                }
              }
            </script>

            <script>
              const prevBtns = document.querySelectorAll(".btn-prev");
              const nextBtns = document.querySelectorAll(".btn-next");
              const progress = document.getElementById("progress");
              const formSteps = document.querySelectorAll(".form-step");
              const progressSteps = document.querySelectorAll(".progress-step");

              let formStepsNum = 0;

              nextBtns.forEach((btn) => {
                btn.addEventListener("click", () => {
                  formStepsNum++;
                  updateFormSteps();
                  updateProgressbar();
                });
              });

              prevBtns.forEach((btn) => {
                btn.addEventListener("click", () => {
                  formStepsNum--;
                  updateFormSteps();
                  updateProgressbar();
                });
              });

              function updateFormSteps() {
                formSteps.forEach((formStep) => {
                  formStep.classList.contains("form-step-active") &&
                    formStep.classList.remove("form-step-active");
                });

                formSteps[formStepsNum].classList.add("form-step-active");
              }

              function updateProgressbar() {
                progressSteps.forEach((progressStep, idx) => {
                  if (idx < formStepsNum + 1) {
                    progressStep.classList.add("progress-step-active");
                  } else {
                    progressStep.classList.remove("progress-step-active");
                  }
                });

                const progressActive = document.querySelectorAll(
                  ".progress-step-active"
                );

                progress.style.width =
                  ((progressActive.length - 1) / (progressSteps.length - 1)) *
                    100 +
                  "%";
              }


              function showParentFields() {
  var parentType = document.getElementById("parent-type").value;
  document.getElementById("father-fields").style.display = parentType === "father" ? "block" : "none";
  document.getElementById("mother-fields").style.display = parentType === "mother" ? "block" : "none";
}
            </script>
            <script>
  let itemCount = 0;

  function addCollateralItem() {
    if (itemCount < 3) {
      itemCount++;
      document.getElementById('item_count').value = itemCount; // Update item count
      const itemDiv = document.createElement('div');
      itemDiv.className = 'collateral-item';
      itemDiv.innerHTML = `
        <h3>Item ${itemCount}</h3>
        <label for="item-name-${itemCount}">Name of Item:</label>
        <input type="text" id="item-name-${itemCount}" name="item-name-${itemCount}" required><br><br>
        <label for="item-description-${itemCount}">Short Description:</label>
        <textarea id="item-description-${itemCount}" name="item-description-${itemCount}" rows="3" style="resize: vertical; width: 100%;" required></textarea><br><br>
        <label>Photos of Item:</label><br>
        <input type="file" name="item-photo-${itemCount}-1" accept="image/*" required><br><br>
        <input type="file" name="item-photo-${itemCount}-2" accept="image/*" required><br><br>
        <input type="file" name="item-photo-${itemCount}-3" accept="image/*" required><br><br>
        <input type="file" name="item-photo-${itemCount}-4" accept="image/*" required><br><br>
      `;
      document.getElementById('collateral-items').appendChild(itemDiv);
    } else {
      alert('You can only add up to 3 collateral items.');
    }
  }
</script>

<script>
              document.getElementById('yourFormId').addEventListener('submit', function(event) {
    if (!this.checkValidity()) {
        event.preventDefault(); // Prevent the form from submitting
        alert('Please fill in all required fields.');
    }
});
</script>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock%}
